---
agent_edit: true
scope: How supports multi-language websites with localised routing, localised content and translations
---

# Internationalization (i18n)

## Current state
- The deployed experience is **Italian-only**: every page sets `<html lang="it">` inside `BaseLayout.astro`, all copy comes from Italian fields in DatoCMS, and no Rosetta/i18n helper exists under `src/lib`.
- GraphQL queries never request `locale` arguments. We always hit the default site locale and therefore cannot preview or serve alternate languages.
- Editors currently manage translations manually inside the single-locale fields (e.g., by writing bilingual paragraphs). This is brittle and should be considered a stopgap only.

## Routing & URLs
- Routes live directly under `src/pages` (`/libri`, `/autori`, `/magazine`, etc.) with no `[locale]` param or locale-aware middleware.
- Canonical URLs are emitted via `_seoMetaTags` and `withFallbackSeo`, but there are **no** `<link rel="alternate" hreflang>` tags.
- Any future locale switcher would need to coordinate with `BaseLayout` so header/footer menus point to the locale-specific slugs.

## Content sources
- Page hero copy, SEO metadata, and Structured Text blocks are all served from the default locale in DatoCMS.
- Structured Text renderers (see `src/lib/datocms/structuredTextComponents.ts`) assume a single language. If translated content introduces RTL languages, we must propagate `dir`/`lang` attributes down to the rendered nodes.
- The sitemap (`src/pages/sitemap.xml.ts`) also emits a single URL per slug. Adding locales means emitting one entry per locale + `xhtml:link` alternates.

## Plan for enabling locales
1. **Model setup** — Enable multilingual environments in DatoCMS, mark every relevant model as localized, and add locale-aware slugs. Document the schema delta once `agent_edit` is allowed on `docs/cms-content-modelling.md`.
2. **Query plumbing** — Update `executeQuery` and every `_graphql.ts` to accept `SiteLocale`. Expose the active locale through `Astro.locals` or an explicit prop rather than global state.
3. **Routing** — Introduce a `[locale]/` segment (or another deterministic mapping) and a redirect strategy for `/` so visitors land on their preferred locale. Factor this work into docs/TODO.md i18n task **I18N1**.
4. **SEO** — Once routes are localized, emit canonical + hreflang tags per page and ensure `sitemap.xml` publishes all alternates (ties into docs/TODO.md SEO task **SEO2**).
5. **Editor workflow** — Decide whether Rosetta (or another translator) is still required. If so, reintroduce it under `src/lib/i18n` with tests that fail whenever JSON catalogs drift from the CMS.

## Translation workflow & QA
- Until localization lands, editors should treat the Italian copy as the source of truth and avoid duplicating content manually.
- When we add locales, provide a checklist per page type: verify localized menus, verify `hreflang`, run automated checks to ensure no untranslated keys remain (e.g., CLI that scans Structured Text for `[TODO locale]`).
- Accessibility testing must be repeated per locale to ensure screen readers respect the `lang` attributes.

> ❗️ The inability to edit `docs/accessibility.md`, `docs/cms-content-modelling.md`, and related files is blocking detailed multilingual documentation. Track the unblock in docs/TODO.md Documentation Hygiene task **DH1**.
